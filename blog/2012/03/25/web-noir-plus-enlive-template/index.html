<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <title>
    Web Noir plus enlive template &middot; 
    my blog at github.io
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.png">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">


  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-26676810-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
</head>


  <body>

    <header class="masthead">
      <div class="masthead-inner">
        <h1><a href="/">Paulo Suzart</a></h1>
        <p>Functional programming (mostly with clojure), virtualization and cloud computing.</p>

        <div class="colophon">
          <ul class="colophon-links">
            <li>
              <a href="https://github.com/paulosuzart">Codes</a>,
            </li>
          </ul>
        </div>
      </div>
    </header>

    <div class="content container">
      <div class="post">
  <h1>Web Noir plus enlive template</h1>
  <span class="post-date">25 Mar 2012</span>
  <p>Hi again! Long time without writing here. But for a good reason.</p>

<p>One of the most promising web frameworks for <a href="http://clojure.org/">clojure</a> is <a href="http://www.webnoir.org/">noir</a>. It is actually an abstraction on top of <a href="https://github.com/mmcgrana/ring/">ring</a> and <a href="https://github.com/weavejester/compojure">Compojure</a>, both successful clojure products.</p>

<p>By default, noir comes with the excellent <a href="https://github.com/weavejester/hiccup">hiccup</a>, which allows one write html in clojure like this:</p>

<p>``` clojure Html in clojure
    (use ‘hiccup.core)
    (def name “Nacho”)
    (html [:span {:id “dog”} name])</p>

<pre><code>;; produces:
;;"&lt;span id=\"dog\"&gt;Nacho&lt;/span&gt;" ``` 
</code></pre>

<p>It doesn’t look designer friendly, right? I would still use hiccup for admin pages or small chunks of html strictly generated by clojure code with a good css to help presenting it.</p>

<p>Enters enlive. I’ve already used enlive <a href="http://codemountain.wordpress.com/2010/10/09/clojure-macros/">before</a>, without understanding it that much, I would say. It’s been almost two years since that post. And what makes me happy with enlive is the possibility to be closer to <a href="http://www.scala-lang.org/">Scala’s</a> web framework <a href="http://liftweb.net/">Lift</a>. That is, put some attention on the view with actually working with actions. So, combine this:</p>

<p><code>html Login form
    &lt;form  method="post" id="login_form"&gt;
        &lt;div id="errors"&gt;
            &lt;span class="error"/&gt;
        &lt;/div&gt;
        &lt;label for="username"&gt;Username&lt;/label&gt;
        &lt;input type="text" id="username" name="username"/&gt;
        &lt;label for="password"&gt;Password&lt;/label&gt;
        &lt;input type="text" id="password" name="password"/&gt;
        &lt;input type="submit" value="Login"/&gt;
     &lt;/form&gt;
</code></p>

<p>With a snippet from enlive:</p>

<p>``` clojure Form snippet</p>

<p>(defn show-errors [msgs]
	(h/clone-for [i msgs]
		[:span.error]
		(h/content i)))</p>

<p>(h/defsnippet _login “mayapp/views/_login.html”  [:#login_form]
	[username password &amp; [errors]]</p>

<pre><code>;;find sa div with ir='errors'
[:div#errors]
(show-errors errors)

;;finds an input with id ='username' and replaces
;;its value attribute by username
[:input#username]
(h/set-attr :value username)

;;the same for password
[:input#password]
(h/set-attr :value password)) ```
</code></pre>

<p>And you have the html output that can be referenced this way:</p>

<p>``` clojure Login page
(defpage “/login” {:as login}
    (_login (:username login) 
		(:password login) 
		(:error login)))))</p>

<p>;;handling the form submit		
(defpage [:post “/login”] {:as login}
	(if (valid? login)
		(format “Yeah!! Welcome %s” (:username login))
		(render “/login” (assoc login :error (v/get-errors)))))		
```</p>

<p>We still have sort of action base framework but with good attention to the view. Not the <code>show-errors</code> function, that can be reused every where with a <code>:div#errors &gt; :span.error</code>. It will repeat the span for every error in <code>msgs</code>.</p>

<p>The error messages may be produce by <code>noir.validation</code> package. In the <code>POST</code> route you can see the snippet being activated with the <code>[errors]</code> argument in case of any errors.</p>

<p>Snippets should be natural for you, and can be used in situations where you define parts of an html, you you have a bigger html resource grouping many parts that cane be a snippet. That is why you passes a selector to <code>defsnipet</code> right after the resource name. That is, transformations will start from this point.</p>

<p>The other option is the <code>deftemplate</code>, it works similar to <code>defsnippet</code>, but doesn’t take any selector as an argument, because it process the entire resource.</p>

<p>A great usage of enlive you can find at <a href="https://github.com/metadaddy-sfdc/facebook-template-clojure/">Facebook/Heroku sample app – Clojure</a>.</p>

<p>And to help you starting with noir plus enlive, I’ve created a template project using <a href="https://github.com/Raynes/lein-newnew">lein-newnew</a>, a way to pack a project as a template, so anyone can reuse it. Please refer to <a href="https://clojars.org/clj-enlive-template">https://clojars.org/clj-enlive-template</a> and the <a href="https://github.com/paulosuzart/clj-enlive-template">clj-enlive-template</a> source code. Just:</p>

<p><code>
lein plugin install clj-enlive-template 0.0.1
lein new clj-enlive-template myproj
cd myproj
lein run
</code></p>

<p>And start having fun with enlive and noir. This project template may be evolved to have <a href="http://sqlkorma.com/">korma</a> or any persistence framework.</p>


</div>

    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = "paulosuzartblog"; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/blog/2015/05/30/give-kotlin-and-quasar-a-try/">
            Give Kotlin And Quasar a Try
            <small>30 May 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/blog/2015/04/02/why-racket-is-awesome/">
            Why Racket is Awesome
            <small>02 Apr 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/blog/2014/07/07/going-back-to-go/">
            Going back to Go (golang)
            <small>07 Jul 2014</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>

  </body>
</html>
