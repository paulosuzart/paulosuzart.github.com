
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Paulo Suzart Blog</title>
  <meta name="author" content="Paulo Suzart">

  
  <meta name="description" content="Hi again! Long time without writing here. But for a good reason. One of the most promising web frameworks for clojure is noir. It is actually an &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://paulosuzart.github.com/blog/page/2">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Paulo Suzart Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-26676810-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Paulo Suzart Blog</a></h1>
  
    <h2>Functional thoughts.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:paulosuzart.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/25/web-noir-plus-enlive-template/">Web Noir Plus Enlive Template</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2012-03-25T21:43:00-03:00" pubdate>Mar 25<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/03/25/web-noir-plus-enlive-template/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Hi again! Long time without writing here. But for a good reason.</p>

<p>One of the most promising web frameworks for <a href="http://clojure.org/">clojure</a> is <a href="http://www.webnoir.org/">noir</a>. It is actually an abstraction on top of <a href="https://github.com/mmcgrana/ring/">ring</a> and <a href="https://github.com/weavejester/compojure">Compojure</a>, both successful clojure products.</p>

<p>By default, noir comes with the excellent <a href="https://github.com/weavejester/hiccup">hiccup</a>, which allows one write html in clojure like this:</p>

<figure class='code'><figcaption><span>Html in clojure</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">use</span> <span class="ss">&#39;hiccup</span><span class="o">.</span><span class="nv">core</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">name</span> <span class="s">&quot;Nacho&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nf">html</span> <span class="p">[</span><span class="nv">:span</span> <span class="p">{</span><span class="nv">:id</span> <span class="s">&quot;dog&quot;</span><span class="p">}</span> <span class="nv">name</span><span class="p">])</span>
</span><span class='line'>
</span><span class='line'><span class="c1">;; produces:</span>
</span><span class='line'><span class="c1">;;&quot;&lt;span id=\&quot;dog\&quot;&gt;Nacho&lt;/span&gt;&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>It doesn&#8217;t look designer friendly, right? I would still use hiccup for admin pages or small chunks of html strictly generated by clojure code with a good css to help presenting it.</p>

<p>Enters enlive. I&#8217;ve already used enlive <a href="http://codemountain.wordpress.com/2010/10/09/clojure-macros/">before</a>, without understanding it that much, I would say. It&#8217;s been almost two years since that post. And what makes me happy with enlive is the possibility to be closer to <a href="http://www.scala-lang.org/">Scala&#8217;s</a> web framework <a href="http://liftweb.net/">Lift</a>. That is, put some attention on the view with actually working with actions. So, combine this:</p>

<figure class='code'><figcaption><span>Login form</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;form</span>  <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">id=</span><span class="s">&quot;login_form&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;errors&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;error&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;username&quot;</span><span class="nt">&gt;</span>Username<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">id=</span><span class="s">&quot;username&quot;</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;password&quot;</span><span class="nt">&gt;</span>Password<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">id=</span><span class="s">&quot;password&quot;</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Login&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'> <span class="nt">&lt;/form&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>With a snippet from enlive:</p>

<figure class='code'><figcaption><span>Form snippet</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="k">defn </span><span class="nv">show-errors</span> <span class="p">[</span><span class="nv">msgs</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">h/clone-for</span> <span class="p">[</span><span class="nv">i</span> <span class="nv">msgs</span><span class="p">]</span>
</span><span class='line'>      <span class="p">[</span><span class="nv">:span</span><span class="o">.</span><span class="nv">error</span><span class="p">]</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">h/content</span> <span class="nv">i</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">h/defsnippet</span> <span class="nv">_login</span> <span class="s">&quot;mayapp/views/_login.html&quot;</span>  <span class="p">[</span><span class="nv">:</span><span class="o">#</span><span class="nv">login_form</span><span class="p">]</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">username</span> <span class="nv">password</span> <span class="nv">&amp;</span> <span class="p">[</span><span class="nv">errors</span><span class="p">]]</span>
</span><span class='line'>  
</span><span class='line'>  <span class="c1">;;find sa div with ir=&#39;errors&#39;</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">:div</span><span class="o">#</span><span class="nv">errors</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">show-errors</span> <span class="nv">errors</span><span class="p">)</span>
</span><span class='line'>  
</span><span class='line'>  <span class="c1">;;finds an input with id =&#39;username&#39; and replaces</span>
</span><span class='line'>  <span class="c1">;;its value attribute by username</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">:input</span><span class="o">#</span><span class="nv">username</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">h/set-attr</span> <span class="nv">:value</span> <span class="nv">username</span><span class="p">)</span>
</span><span class='line'>  
</span><span class='line'>  <span class="c1">;;the same for password</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">:input</span><span class="o">#</span><span class="nv">password</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">h/set-attr</span> <span class="nv">:value</span> <span class="nv">password</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>And you have the html output that can be referenced this way:</p>

<figure class='code'><figcaption><span>Login page</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">defpage</span> <span class="s">&quot;/login&quot;</span> <span class="p">{</span><span class="nv">:as</span> <span class="nv">login</span><span class="p">}</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">_login</span> <span class="p">(</span><span class="nf">:username</span> <span class="nv">login</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">:password</span> <span class="nv">login</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">:error</span> <span class="nv">login</span><span class="p">)))))</span>
</span><span class='line'>
</span><span class='line'><span class="c1">;;handling the form submit       </span>
</span><span class='line'><span class="p">(</span><span class="nf">defpage</span> <span class="p">[</span><span class="nv">:post</span> <span class="s">&quot;/login&quot;</span><span class="p">]</span> <span class="p">{</span><span class="nv">:as</span> <span class="nv">login</span><span class="p">}</span>
</span><span class='line'>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">valid?</span> <span class="nv">login</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;Yeah!! Welcome %s&quot;</span> <span class="p">(</span><span class="nf">:username</span> <span class="nv">login</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">render</span> <span class="s">&quot;/login&quot;</span> <span class="p">(</span><span class="nb">assoc </span><span class="nv">login</span> <span class="nv">:error</span> <span class="p">(</span><span class="nf">v/get-errors</span><span class="p">)))))</span>        
</span></code></pre></td></tr></table></div></figure>


<p>We still have sort of action base framework but with good attention to the view. Not the <code>show-errors</code> function, that can be reused every where with a <code>:div#errors &gt; :span.error</code>. It will repeat the span for every error in <code>msgs</code>.</p>

<p>The error messages may be produce by <code>noir.validation</code> package. In the <code>POST</code> route you can see the snippet being activated with the <code>[errors]</code> argument in case of any errors.</p>

<p>Snippets should be natural for you, and can be used in situations where you define parts of an html, you you have a bigger html resource grouping many parts that cane be a snippet. That is why you passes a selector to <code>defsnipet</code> right after the resource name. That is, transformations will start from this point.</p>

<p>The other option is the <code>deftemplate</code>, it works similar to <code>defsnippet</code>, but doesn&#8217;t take any selector as an argument, because it process the entire resource.</p>

<p>A great usage of enlive you can find at <a href="https://github.com/metadaddy-sfdc/facebook-template-clojure/">Facebook/Heroku sample app &#8211; Clojure</a>.</p>

<p>And to help you starting with noir plus enlive, I&#8217;ve created a template project using <a href="https://github.com/Raynes/lein-newnew">lein-newnew</a>, a way to pack a project as a template, so anyone can reuse it. Please refer to <a href="https://clojars.org/clj-enlive-template">https://clojars.org/clj-enlive-template</a> and the <a href="https://github.com/paulosuzart/clj-enlive-template">clj-enlive-template</a> source code. Just:</p>

<figure class='code'><figcaption><span>Login page</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="nv">lein</span> <span class="nv">plugin</span> <span class="nv">install</span> <span class="nv">clj-enlive-template</span> <span class="mf">0.0</span><span class="o">.</span><span class="mi">1</span>
</span><span class='line'><span class="nv">lein</span> <span class="nv">new</span> <span class="nv">clj-enlive-template</span> <span class="nv">myproj</span>
</span><span class='line'><span class="nv">cd</span> <span class="nv">myproj</span>
</span><span class='line'><span class="nv">lein</span> <span class="nv">run</span>
</span></code></pre></td></tr></table></div></figure>


<p>And start having fun with enlive and noir. This project template may be evolved to have <a href="http://sqlkorma.com/">korma</a> or any persistence framework.</p>

<p>Don&#8217;t forget to visit the <a href="/about">about</a> page. And follow me on Twitter: <a href="http://twitter.com/paulosuzart">@paulosuzart</a>.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/02/03/clojure-macros-automating-aws-simpledb-admin-tasks/">Clojure Macros: Automating AWS SimpleDB Admin Tasks.</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2012-02-03T21:16:00-02:00" pubdate>Feb 3<span>rd</span>, 2012</time>
        
         | <a href="/blog/2012/02/03/clojure-macros-automating-aws-simpledb-admin-tasks/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>First post of the year! To talk about clojure, of course.
<a href="http://codemountain.wordpress.com/2010/10/09/clojure-macros/">I&#8217;ve written (pt_br)</a> about clojure macros before. And yes, it is really powerful.</p>

<p>I&#8217;m using macros to help me setting up a connection with <a href="http://aws.amazon.com/simpledb/">Amazon SimpleDB</a> to do some small administrative tasks such as listing domains, creating domains, counting items in a domain, etc.</p>

<p>SimpleDB hasn&#8217;t a console, so you have interact with it using a pure html + js application provided by AWS, or do it by hand. I do prefer doing it by my own :). Then I created de following macro:</p>

<figure class='code'><figcaption><span>SimpleDB admin tasks </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="k">defmacro </span><span class="nv">boot-sdb</span> <span class="p">[]</span>
</span><span class='line'>  <span class="o">&#39;</span><span class="p">(</span><span class="nv">do</span>
</span><span class='line'>
</span><span class='line'>      <span class="p">(</span><span class="o">.</span><span class="nv">setLevel</span> <span class="p">(</span><span class="nf">java</span><span class="o">.</span><span class="nv">util</span><span class="o">.</span><span class="nv">logging</span><span class="o">.</span><span class="nv">Logger/getLogger</span> <span class="s">&quot;com.amazonaws&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="nv">java</span><span class="o">.</span><span class="nv">util</span><span class="o">.</span><span class="nv">logging</span><span class="o">.</span><span class="nv">Level/WARNING</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="o">.</span><span class="nv">setLevel</span> <span class="p">(</span><span class="nf">java</span><span class="o">.</span><span class="nv">util</span><span class="o">.</span><span class="nv">logging</span><span class="o">.</span><span class="nv">Logger/getLogger</span> <span class="s">&quot;httpclient&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="nv">java</span><span class="o">.</span><span class="nv">util</span><span class="o">.</span><span class="nv">logging</span><span class="o">.</span><span class="nv">Level/WARNING</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="o">.</span><span class="nv">setLevel</span> <span class="p">(</span><span class="nf">java</span><span class="o">.</span><span class="nv">util</span><span class="o">.</span><span class="nv">logging</span><span class="o">.</span><span class="nv">Logger/getLogger</span> <span class="s">&quot;org.apache.commons.httpclient&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="nv">java</span><span class="o">.</span><span class="nv">util</span><span class="o">.</span><span class="nv">logging</span><span class="o">.</span><span class="nv">Level/WARNING</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="p">(</span><span class="nf">require</span> <span class="p">(</span><span class="nf">quote</span> <span class="p">[</span><span class="nv">cemerick</span><span class="o">.</span><span class="nv">rummage</span> <span class="nv">:as</span> <span class="nv">sdb</span><span class="p">]))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">require</span> <span class="p">(</span><span class="nf">quote</span> <span class="p">[</span><span class="nv">cemerick</span><span class="o">.</span><span class="nv">rummage</span><span class="o">.</span><span class="nv">encoding</span> <span class="nv">:as</span> <span class="nv">enc</span><span class="p">]))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">use</span> <span class="p">(</span><span class="nf">quote</span> <span class="nv">apix</span><span class="o">.</span><span class="nv">util</span><span class="p">))</span>
</span><span class='line'>      
</span><span class='line'>      <span class="p">(</span><span class="k">def </span><span class="nv">*sdb*</span> <span class="p">(</span><span class="nf">sdb/create-client</span> <span class="p">(</span><span class="nf">env</span> <span class="s">&quot;AWS_KEYID&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nf">env</span> <span class="s">&quot;AWS_KEY&quot;</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="k">def </span><span class="nv">*sdbconf*</span> <span class="p">(</span><span class="nb">assoc </span><span class="nv">enc/keyword-strings</span> <span class="nv">:client</span> <span class="nv">*sdb*</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="nb">println </span><span class="s">&quot;Connected to SDB.&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="p">(</span><span class="k">defn </span><span class="nv">lsd</span> <span class="p">[]</span> <span class="p">(</span><span class="nf">sdb/list-domains</span> <span class="nv">*sdbconf*</span><span class="p">))</span>
</span><span class='line'>      
</span><span class='line'>
</span><span class='line'>      <span class="p">(</span><span class="k">defn </span><span class="nv">mkd</span> <span class="p">[</span><span class="nv">d</span><span class="p">]</span> <span class="p">(</span><span class="nf">sdb/create-domain</span> <span class="nv">*sdbconf*</span> <span class="nv">d</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>      <span class="p">(</span><span class="k">defn </span><span class="nv">rmd</span> <span class="p">[</span><span class="nv">d</span><span class="p">]</span> <span class="p">(</span><span class="nf">sdb/delete-domain</span> <span class="nv">*sdbconf*</span> <span class="nv">d</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>      <span class="p">(</span><span class="k">defn </span><span class="nv">countd</span> <span class="p">[</span><span class="nv">d</span><span class="p">]</span> <span class="p">(</span><span class="nf">str</span>
</span><span class='line'>                          <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;Total items [%s]: &quot;</span> <span class="nv">d</span><span class="p">)</span>
</span><span class='line'>                          <span class="p">(</span><span class="nf">:itemCount</span> <span class="p">(</span><span class="nf">sdb/domain-metadata</span> <span class="nv">*sdbconf*</span> <span class="nv">d</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'>      <span class="p">(</span><span class="k">defn </span><span class="nv">sdb-help</span> <span class="p">[]</span>
</span><span class='line'>          <span class="p">(</span><span class="nb">println </span><span class="s">&quot;Type &#39;(lsd)&#39; to list all domains&quot;</span><span class="p">)</span>
</span><span class='line'>          <span class="p">(</span><span class="nb">println </span><span class="s">&quot;Type &#39;(mkd domain-name)&#39; to create a new domain&quot;</span><span class="p">)</span>
</span><span class='line'>          <span class="p">(</span><span class="nb">println </span><span class="s">&quot;Type &#39;(rmd domain-name)&#39; to delete a domain&quot;</span><span class="p">)</span>  
</span><span class='line'>          <span class="p">(</span><span class="nb">println </span><span class="s">&quot;Type &#39;(countd domain)&#39; to get the items count of domain&quot;</span><span class="p">)</span>
</span><span class='line'>          <span class="p">(</span><span class="nb">println </span><span class="s">&quot;Type &#39;(sdb-help)&#39; to see this help again&quot;</span><span class="p">))</span>
</span><span class='line'>      
</span><span class='line'>      <span class="p">(</span><span class="nf">sdb-help</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>It saves the work of configuring the appropriate log levels as well as creating SimpleDB client using <a href="https://github.com/cemerick/rummage">rummage</a> (a SimpleDB client by <a href="twitter.com/cemerick">@cemerick</a>).</p>

<p>And why a macro? Because in some extent you can see a macro as a code template, just like <a href="http://velocity.apache.org/">Velocity</a> or <a href="http://www.stringtemplate.org/">String Template</a>. So what this macro does is just &#8220;typing&#8221; all this code on my REPL namespace, than the defined functions and vars are automatic available in the <code>user</code> namespace.</p>

<p>Using it is simple:</p>

<figure class='code'><figcaption><span>Using the macro</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">use</span> <span class="ss">&#39;the</span><span class="o">.</span><span class="nv">macro</span><span class="o">.</span><span class="nv">namespace</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nf">boot-sdb</span><span class="p">)</span>
</span><span class='line'><span class="nv">Connected</span> <span class="nv">to</span> <span class="nv">SDB</span><span class="o">.</span>
</span><span class='line'><span class="nv">Type</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">lsd</span><span class="p">)</span><span class="o">&#39;</span> <span class="nv">to</span> <span class="nv">list</span> <span class="nv">all</span> <span class="nv">domains</span>
</span><span class='line'><span class="nv">Type</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">mkd</span> <span class="nv">domain-name</span><span class="p">)</span><span class="o">&#39;</span> <span class="nv">to</span> <span class="nv">create</span> <span class="nv">a</span> <span class="nv">new</span> <span class="nv">domain</span>
</span><span class='line'><span class="nv">Type</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">rmd</span> <span class="nv">domain-name</span><span class="p">)</span><span class="o">&#39;</span> <span class="nv">to</span> <span class="nv">delete</span> <span class="nv">a</span> <span class="nv">domain</span>
</span><span class='line'><span class="nv">Type</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">countd</span> <span class="nv">domain</span><span class="p">)</span><span class="o">&#39;</span> <span class="nv">to</span> <span class="nv">get</span> <span class="nv">the</span> <span class="nv">items</span> <span class="nv">count</span> <span class="nv">of</span> <span class="nv">domain</span>
</span><span class='line'><span class="nv">Type</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">sdb-help</span><span class="p">)</span><span class="o">&#39;</span> <span class="nv">to</span> <span class="nv">see</span> <span class="nv">this</span> <span class="nv">help</span> <span class="nv">again</span>
</span><span class='line'><span class="nv">nil</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>(boot-sdb)</code> &#8220;types&#8221; all the code for you, then you can call the functions like <code>(lsd)</code> to get the list of domains in your SimpleDB.</p>

<p>If take a closer look you may notice a function call to <code>(env "AWS_KEYID")</code>. It simply gets the environment variables set with your credentials.</p>

<p>You can extend the macro to have any admin task you may need. Note that the <code>*sdbconf*</code> will become available, so you can call rummage directly without having to configure all again.</p>

<p>That is it. Clojure is smart!</p>

<p>Don&#8217;t forget to visit the <a href="/about">about</a> page. And follow me on Twitter: <a href="http://twitter.com/paulosuzart">@paulosuzart</a>.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/12/11/my-own-redis-types-text-notation/">My Own REDIS Types - Text - Notation</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2011-12-11T18:11:00-02:00" pubdate>Dec 11<span>th</span>, 2011</time>
        
         | <a href="/blog/2011/12/11/my-own-redis-types-text-notation/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Some seconds after the <a href="http://paulosuzart.github.com/blog/2011/12/11/my-own-redis-types-notation/">last post</a>, <a href="http://twitter.com/paraseba">@paraseba</a> commented that a text version of this notation may be even more helpful.</p>

<p>Here it is:</p>

<ul>
<li><code>$</code> means provided by some interaction with redis.</li>
<li><code>*</code> means provided by user.</li>
<li><code>key</code> represents a redis KEY with the value set by <code>SET</code>.</li>
<li><code>(listkey)</code> represents a redis LIST with elements manipulated by <code>LPUSH</code> and so on.</li>
<li><code>{hashkey [key values]}</code> represents a redis <code>HASH</code> with data set by <code>HSET</code> or <code>HMSET</code>.</li>
<li><code>#{setkey data}</code> represents a set or sorted set.</li>
<li><code>as $varname</code> may be used for situations where <code>INCR</code> is used to generate an ID.</li>
</ul>


<p>The last post user creation process may be written as:</p>

<pre><code>users:next as $uid
{users:$uid data}
#{users:pending:confirmation $uid)
#{messages:welcome $uid}
(users:send:mail *mail)
</code></pre>

<p>An instance of this process would be:</p>

<pre><code>users:next ;; suppose 21 as result
{users:21 [name Abraao mail somemailhere@gmail.com status pending-mail-confirmation]}
#{users:pending:confirmation 21)
#{messages:welcome 21}
(users:send:mail somemailhere@gmail.com)
</code></pre>

<p>It is the form I&#8217;m using as doc strings in a namespace. It looks great with <a href="http://www.fogus.me/fun/marginalia/">Marginalia</a>.</p>

<p>Don&#8217;t forget to visit the <a href="/about">about</a> page. And follow me on Twitter: <a href="http://twitter.com/paulosuzart">@paulosuzart</a>.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/12/11/my-own-redis-types-notation/">My Own REDIS Types Notation</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2011-12-11T17:20:00-02:00" pubdate>Dec 11<span>th</span>, 2011</time>
        
         | <a href="/blog/2011/12/11/my-own-redis-types-notation/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One of the greatest <a href="http://en.wikipedia.org/wiki/NoSQL">NoSQL</a> <a href="http://en.wikipedia.org/wiki/NoSQL#Key-value_store">key-value</a> databases I value most, is <a href="http://redis.io/">redis</a>. It is simple, fast and tasty.</p>

<p>You interact with redis through its protocol. They are divided by commands that you can apply to its different data structures. These structures are Key, String, Hashes, Lists, Sets, Sorted Sets and channels (this one used for <a href="http://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern">pub/sub pattern</a>).</p>

<p>Since redis is key-value, it means you can store only keys with values. Right? It may sound bad at the beginning, but you get the way as you try. I&#8217;m just a newbe in redis world and I&#8217;m feeling comfortable with it.</p>

<p>So, due to its key-value nature you should create some structures around you main structure to help you query your data. Suppose you are using a redis <code>HASH</code> to store user information. In a javascript notation:</p>

<pre><code>HMSET  users:21 name Abraão mail somemailhere@gmail.com status pending-mail-confirmation
</code></pre>

<p><code>HMSET</code> is a command to store all the <code>HASH</code> entries into a <code>HASH</code> identified by <code>user:21</code> key. And for some reason, your system get all users pending mail confirmation and send them a remember. There is no way to get all the users that has mail confirmation pending other than check every user status, what would be expensive. A helper structure may save you from this.</p>

<pre><code>SADD users:pending:confirmation 21
</code></pre>

<p>Bingo. Now your background process can pick up users to remember mail confirmation from the <code>SET</code> identified by <code>users:pending:confirmation</code> key.</p>

<p>Suppose you also want to show a welcome message to the user in the first time it visits you. You may use another helper structure.</p>

<pre><code>SADD messages:welcome 21
</code></pre>

<p>Thus, your system queries a <code>SET</code> identified by <code>messages:welcome</code> key to check if it should show a welcome message to the user. And finally, at the moment of user&#8217;s creation, your system wants to send some information through mail also in a back ground process. Again a helper structure.</p>

<pre><code>LPUSH users:send:mail somemailhere@gmail.com
</code></pre>

<p>Lot of thing to just create a user. Now imagine a big code base and even complex interactions with other helper structures like sorted sets to store information related to age, date, etc. It was my situation last week while interacting with redis.</p>

<p>To make things clear and easy to remember and document. I created a simple, yet helpful (for me at least) notation to document redis structures and the sequence of interactions. Te symbols are:</p>

<p><img src="https://s3.amazonaws.com/suzart.blogs.posts/redislayout/Slide1.jpg" alt="redis Types Notation" /></p>

<p>Now our user&#8217;s creation process using the notation we have:</p>

<p><img src="https://s3.amazonaws.com/suzart.blogs.posts/redislayout/Slide4.jpg" alt="User's creation interactions" /></p>

<p>It is simple and is helping a lot. Another good thing I started to do is to write queries in plain english (portuguese actually :)) to help identify which types of queries a structure is helping me to answer. To see a text version of it, visit this <a href="http://paulosuzart.github.com/blog/2011/12/11/my-own-redis-types-text-notation/">new post</a>.</p>

<p>I&#8217;m using <a href="https://github.com/mmcgrana/clj-redis/">clj-redis</a> interact with redis.</p>

<p>Don&#8217;t forget to visit the <a href="/about">about</a> page. And follow me on Twitter: <a href="http://twitter.com/paulosuzart">@paulosuzart</a>.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/12/04/korma-and-clojure-records/">Korma and Clojure Records</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2011-12-04T19:02:00-02:00" pubdate>Dec 4<span>th</span>, 2011</time>
        
         | <a href="/blog/2011/12/04/korma-and-clojure-records/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://sqlkorma.com">Korma</a> is a <a href="http://clojure.org">clojure</a> framework (by <a href="http://twitter.com/ibdknox">@ibdknox</a>) that provides great SQL abstractions. You can work purely with clojure code without inserting SQL strings into your code.</p>

<p>Consider the following entities:</p>

<figure class='code'><figcaption><span>Using defentity </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'> <span class="p">(</span><span class="nf">defdb</span> <span class="nv">mydb</span> <span class="p">(</span><span class="nf">mysql</span>
</span><span class='line'>                     <span class="p">{</span><span class="nv">:port</span> <span class="mi">3306</span>
</span><span class='line'>                       <span class="nv">:host</span> <span class="s">&quot;localhost&quot;</span>
</span><span class='line'>                       <span class="nv">:user</span> <span class="s">&quot;root&quot;</span>
</span><span class='line'>                       <span class="nv">:db</span> <span class="s">&quot;korma_post&quot;</span><span class="p">}))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">defentity</span> <span class="nv">email</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">database</span> <span class="nv">mydb</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">defentity</span> <span class="nv">person</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">has-one</span> <span class="nv">email</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">database</span> <span class="nv">mydb</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>email</code> is the representation of the email table in a mysql database. Note that you don&#8217;t need to specify any fields. It is optional. In this case, both entities will return the column&#8217;s name as map keys in a given select. Let&#8217;s see:</p>

<figure class='code'><figcaption><span>Selecting your data </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nb">select </span><span class="nv">person</span> <span class="p">(</span><span class="nf">with</span> <span class="nv">email</span><span class="p">)))</span>
</span><span class='line'><span class="c1">;;will return</span>
</span><span class='line'><span class="p">[{</span><span class="nv">:id</span> <span class="mi">1</span><span class="o">,</span> <span class="nv">:name</span> <span class="s">&quot;Paulo Suzart&quot;</span><span class="o">,</span>
</span><span class='line'>   <span class="nv">:age</span> <span class="mi">29</span><span class="o">,</span> <span class="nv">:id_2</span> <span class="mi">1</span><span class="nv">x,</span>
</span><span class='line'>   <span class="nv">:email</span> <span class="s">&quot;paulosuzart@gmail.com&quot;</span><span class="o">,</span>
</span><span class='line'>   <span class="nv">:person_id</span> <span class="mi">1</span><span class="p">}</span>
</span><span class='line'> <span class="p">{</span><span class="nv">:id</span> <span class="mi">2</span><span class="o">,</span>
</span><span class='line'>   <span class="nv">:name</span> <span class="s">&quot;Rafael Felini&quot;</span><span class="o">,</span>
</span><span class='line'>   <span class="nv">:age</span> <span class="mi">27</span><span class="o">,</span>
</span><span class='line'>   <span class="nv">:id_2</span> <span class="mi">2</span><span class="o">,</span>
</span><span class='line'>   <span class="nv">:email</span> <span class="s">&quot;rafael.felini@gmail.com&quot;</span><span class="o">,</span>
</span><span class='line'>   <span class="nv">:person_id</span> <span class="mi">2</span><span class="p">}]</span>
</span></code></pre></td></tr></table></div></figure>


<p>The result look like a java Resultset. You can choose the original column names to pass around your application. And since clojure is not type safe or compiled, you may find yourself suffering in cases of database refactories.</p>

<p>A nice solution is to combine Korma <code>entities</code> with <code>transform</code> function and clojure <code>defrecord</code> to get rid of this problem, as well as diminish the surface contact of your code concerned with database access. One solution we (me and <a href="http://twitter.com/rafaelfelini">@rafaelfelini</a>) have found was:</p>

<figure class='code'><figcaption><span>Combining entities with transform and defrecord </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">defrecord</span> <span class="nv">Person</span> <span class="p">[</span><span class="nv">id</span> <span class="nv">name</span> <span class="nv">age</span> <span class="nv">email</span><span class="p">])</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">defentity</span> <span class="nv">person</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">transform</span> <span class="o">#</span><span class="p">(</span><span class="nv">Person</span><span class="o">.</span> <span class="p">(</span><span class="nf">:id</span> <span class="nv">%</span><span class="p">)</span> <span class="p">(</span><span class="nf">:name</span> <span class="nv">%</span><span class="p">)</span> <span class="p">(</span><span class="nf">:age</span> <span class="nv">%</span><span class="p">)</span> <span class="p">(</span><span class="nf">:email</span> <span class="nv">%</span><span class="p">)))</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">has-one</span> <span class="nv">email</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">database</span> <span class="nv">mydb</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="c1">;; now try again</span>
</span><span class='line'><span class="p">(</span><span class="nb">select </span><span class="nv">person</span> <span class="p">(</span><span class="nf">with</span> <span class="nv">email</span><span class="p">)))</span>
</span><span class='line'><span class="c1">;; will return</span>
</span><span class='line'><span class="p">(</span><span class="o">#</span><span class="nv">:user</span><span class="o">.</span><span class="nv">Person</span><span class="p">{</span><span class="nv">:id</span> <span class="mi">1</span><span class="o">,</span>
</span><span class='line'>                         <span class="nv">:name</span> <span class="s">&quot;Paulo Suzart&quot;</span><span class="o">,</span>
</span><span class='line'>                         <span class="nv">:age</span> <span class="mi">29</span><span class="o">,</span>
</span><span class='line'>                         <span class="nv">:email</span> <span class="s">&quot;paulosuzart@gmail.com&quot;</span><span class="p">}</span>
</span><span class='line'> <span class="o">#</span><span class="nv">:user</span><span class="o">.</span><span class="nv">Person</span><span class="p">{</span><span class="nv">:id</span> <span class="mi">2</span><span class="o">,</span>
</span><span class='line'>                         <span class="nv">:name</span> <span class="s">&quot;Rafael Felini&quot;</span><span class="o">,</span>
</span><span class='line'>                         <span class="nv">:age</span> <span class="mi">27</span><span class="o">,</span>
</span><span class='line'>                         <span class="nv">:email</span> <span class="s">&quot;rafael.felini@gmail.com&quot;</span><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>transform</code> function takes another function that transforms a database record (with the column names as keys) into a clojure&#8217;s record. In this case <code>Person</code> is the record - that always holds the e-mail. Korma takes care of the join, assuming that the <code>email</code> table has a column called <code>person_id</code>.</p>

<p>Now your code is a bit more resilient to database changes with this thing layer of transformation. Actually a good practice you&#8217;ve done all life as developer.</p>

<p>Korma can do a lot of things to make your life easier, as the abililty to compose queries, and performs really nice. Think I finally found THE framework for relational data access in clojure.</p>

<p>Don&#8217;t forget to visit the <a href="/about">about</a> page. And follow me on Twitter: <a href="http://twitter.com/paulosuzart">@paulosuzart</a>.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/10/30/dateparammatcher-for-finagle/">DateParamMatcher for Finagle</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2011-10-30T23:22:00-02:00" pubdate>Oct 30<span>th</span>, 2011</time>
        
         | <a href="/blog/2011/10/30/dateparammatcher-for-finagle/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://twitter.github.com/finagle">Twitter Finagle</a> is an amazing framework for RPC communication, and my interest is its HTTP features for creating RESTful APIs.</p>

<p>As I bloged at <a href="http://codemountain.wordpress.com/2011/10/14/twitter-finagle-primeiras-impressoes/">codemountain</a>, I&#8217;m using finagle for a personal project. Don&#8217;t know how far it will go, but the facts is that I&#8217;m learning Finagle a lot.</p>

<p>During this project I needed to extract from the query string, a param to be parsed to a twitter.util.Time. I ended up with a Param Matcher to be used my a pattern match agains the requested path. The use of this Param Patcher is:</p>

<figure class='code'><figcaption><span>Using the DateParamMatcher</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="c1">//...</span>
</span><span class='line'><span class="nc">Path</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="o">)</span> <span class="o">:?</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>       <span class="k">case</span> <span class="nc">Root</span> <span class="o">/</span> <span class="s">&quot;myPath&quot;</span> <span class="o">:?</span> <span class="nc">RequestTime</span><span class="o">(</span><span class="n">requestTimeParam</span><span class="o">)</span>  <span class="k">=&gt;</span> <span class="c1">//do something</span>
</span><span class='line'><span class="c1">//..</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="c1">//Where RequestTime is defined as</span>
</span><span class='line'> <span class="k">object</span> <span class="nc">RequestTime</span> <span class="k">extends</span> <span class="nc">DateParamMatcher</span><span class="o">(</span><span class="s">&quot;requestTimeParam&quot;</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The source of DateParamMatcher is the following.</p>

<figure class='code'><figcaption><span>Param Matcher for twitter.util.Time</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">import</span> <span class="nn">com.twitter.util.Time._</span>
</span><span class='line'><span class="k">import</span> <span class="nn">com.twitter.util.Time</span>
</span><span class='line'><span class="k">import</span> <span class="nn">java.text.ParseException</span>
</span><span class='line'><span class="k">import</span> <span class="nn">com.twitter.finagle.http.path._</span>
</span><span class='line'><span class="k">import</span> <span class="nn">com.twitter.finagle.http.ParamMap</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Extractor that takes a request parameter and converts it to a {twitter.util.Time}.</span>
</span><span class='line'><span class="cm"> * The date format should conform with {twitter.util.Time} default format.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="k">abstract</span> <span class="k">class</span> <span class="nc">DateParamMatcher</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">unapply</span><span class="o">(</span><span class="n">params</span><span class="k">:</span> <span class="kt">ParamMap</span><span class="o">)</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Time</span><span class="o">]</span> <span class="k">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="n">flatMap</span> <span class="o">{</span> <span class="n">value</span> <span class="k">=&gt;</span>
</span><span class='line'>    <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>      <span class="nc">Some</span><span class="o">(</span><span class="n">at</span><span class="o">(</span><span class="n">value</span><span class="o">))</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">catch</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="n">ex</span><span class="k">:</span> <span class="kt">ParseException</span> <span class="o">=&gt;</span>
</span><span class='line'>        <span class="nc">None</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finagle also provides an abstract <code>com.twitter.finagle.http.path.ParamMatcher</code> as well as <code>LongParamMatcher</code> and <code>IntParamMatcher</code> in the same package. They are actually Scala  Extractors (very well explained <a href="http://codemonkeyism.com/scala-goodness-extractors/">here</a> by @codemonkeyism). This is a practical way to extract values from a query string and put it available at your code already parsed.</p>

<p>Note that if the param named <code>requestTimeParam</code> is not present or carries a invalid value for <code>Time</code> in the query string the <code>None</code> value is returned.</p>

<p>Although easy to build and extract params from query string and requested path, it is not a Finagle strength. It is kinda limited. A better abstraction is offered by <a href="https://github.com/unfiltered/unfiltered">Unfiltered</a>(another <a href="http://twitter.com/n8han">@n8han&#8217;s</a> great job).</p>

<p>Hope you enjoy it.</p>

<p>Don&#8217;t forget to visit the <a href="/about">about</a> page. And follow me on Twitter: <a href="http://twitter.com/paulosuzart">@paulosuzart</a>.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/10/30/what-you-are-supposed-to-find-here/">What You Are Supposed to Find Here</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2011-10-30T23:09:00-02:00" pubdate>Oct 30<span>th</span>, 2011</time>
        
         | <a href="/blog/2011/10/30/what-you-are-supposed-to-find-here/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Hi, this is another blog of mine. Yap, I have a - mostly in portuguese - wordpress called <a href="http://codemountain.wordpress.com">codemountain</a>, and a <a href="http://posterous.com/paulosuzart">Posterous</a>. Maybe I move to here and kill the others. Don&#8217;t know yet.</p>

<p>The main reason to starting blogging directly on my Github is to keep the subjects even more focused on projects committed here, and share some experiences with some libs also committed here.</p>

<p>Don&#8217;t forget to visit the <a href="/about">about</a> page. And follow me on Twitter: <a href="http://twitter.com/paulosuzart">@paulosuzart</a>.</p>

</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/10/30/understanding-clojure-apply-and-partial/">Understanding Clojure apply and partial</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/20/ultrafast-web-development-with-perl-plus-bootstrap-plus-mongodb/">Ultrafast web development with Perl + Bootstrap + MongoDB</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/08/26/geocoding-csvs-with-clojure/">Geocoding CSVs with Clojure</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/08/21/docker-plus-ansible/">Docker + Ansible</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/20/janus-plus-ack-grep-plus-fish-shell-tools-to-rule-everything/">Janus + ack-grep + fish shell: Tools to rule everything</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Github Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/paulosuzart">@paulosuzart</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'paulosuzart',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("paulosuzart", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/paulosuzart" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @paulosuzart</a>
  
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Paulo Suzart -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'paulosuzartblog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
